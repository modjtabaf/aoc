
#include <algorithm>
#include <functional>
#include <iostream>
#include <tuple>
#include <vector>

using Coord = ulong;
using Pos = std::pair<std::array<Coord, 3>, int>;
using Poses = std::vector<Pos>;

Poses sample_poses{
    {{162,817,812}, 0},
    {{57,618,57}, 0},
    {{906,360,560}, 0},
    {{592,479,940}, 0},
    {{352,342,300}, 0},
    {{466,668,158}, 0},
    {{542,29,236}, 0},
    {{431,825,988}, 0},
    {{739,650,466}, 0},
    {{52,470,668}, 0},
    {{216,146,977}, 0},
    {{819,987,18}, 0},
    {{117,168,530}, 0},
    {{805,96,715}, 0},
    {{346,949,466}, 0},
    {{970,615,88}, 0},
    {{941,993,340}, 0},
    {{862,61,35}, 0},
    {{984,92,344}, 0},
    {{425,690,689}, 0},
};

Poses test_poses{
    {{88578,88119,36620}, 0},
    {{47284,65523,33494}, 0},
    {{58606,16747,55999}, 0},
    {{40991,85566,60119}, 0},
    {{91623,26594,26700}, 0},
    {{16770,70975,76232}, 0},
    {{23079,51888,72508}, 0},
    {{55737,44238,74352}, 0},
    {{14593,1047,59712}, 0},
    {{27244,82475,55158}, 0},
    {{4325,32328,55224}, 0},
    {{98318,6894,97698}, 0},
    {{92311,45887,78669}, 0},
    {{66357,34523,28202}, 0},
    {{3826,79572,50455}, 0},
    {{84470,53406,3296}, 0},
    {{13657,90366,65383}, 0},
    {{58672,30180,40602}, 0},
    {{26285,62771,88350}, 0},
    {{43575,28960,16123}, 0},
    {{66092,77305,11399}, 0},
    {{26612,83394,52761}, 0},
    {{43538,81007,13081}, 0},
    {{32446,83253,26021}, 0},
    {{79902,35490,75208}, 0},
    {{99729,61350,3536}, 0},
    {{93236,24783,11960}, 0},
    {{9418,99969,89504}, 0},
    {{32299,19174,8470}, 0},
    {{68257,93173,309}, 0},
    {{16818,73927,61700}, 0},
    {{39911,55516,62598}, 0},
    {{98229,56193,41991}, 0},
    {{82257,49065,68948}, 0},
    {{99586,46327,29721}, 0},
    {{27410,38674,30875}, 0},
    {{14998,68776,53629}, 0},
    {{17324,46301,14563}, 0},
    {{95555,95332,62013}, 0},
    {{73743,91108,82277}, 0},
    {{14659,56829,92354}, 0},
    {{24437,78491,60477}, 0},
    {{31291,2749,74867}, 0},
    {{31601,80728,44055}, 0},
    {{60327,88204,76478}, 0},
    {{22305,76302,63080}, 0},
    {{64963,47589,50308}, 0},
    {{49236,6939,72495}, 0},
    {{49669,92268,88424}, 0},
    {{72559,11385,76222}, 0},
    {{81137,72017,29565}, 0},
    {{43664,18932,18272}, 0},
    {{56714,37255,46428}, 0},
    {{52970,31593,35032}, 0},
    {{79087,68235,56733}, 0},
    {{12508,38481,70923}, 0},
    {{18167,15792,86011}, 0},
    {{42842,31509,86810}, 0},
    {{36499,81350,58014}, 0},
    {{86811,49038,22716}, 0},
    {{15222,11404,45691}, 0},
    {{94012,95743,49835}, 0},
    {{23645,51255,48863}, 0},
    {{85111,98452,48996}, 0},
    {{99946,58307,35175}, 0},
    {{46040,17130,80225}, 0},
    {{1382,93348,50937}, 0},
    {{93006,66929,23123}, 0},
    {{95932,91681,6506}, 0},
    {{75680,62579,65680}, 0},
    {{53738,65644,18103}, 0},
    {{19379,52012,17535}, 0},
    {{6526,61808,34359}, 0},
    {{48792,96578,3035}, 0},
    {{258,65029,21788}, 0},
    {{69629,93850,66808}, 0},
    {{66734,16528,99029}, 0},
    {{71968,47703,6743}, 0},
    {{70575,94570,22517}, 0},
    {{94402,5739,16549}, 0},
    {{14187,47877,11513}, 0},
    {{56204,24621,7083}, 0},
    {{43685,7753,59557}, 0},
    {{77821,34305,66262}, 0},
    {{53238,23288,4487}, 0},
    {{94657,23308,42069}, 0},
    {{94788,55191,62716}, 0},
    {{98258,71480,52179}, 0},
    {{78837,44360,64698}, 0},
    {{90127,71002,4610}, 0},
    {{15103,80080,29482}, 0},
    {{45110,95850,54489}, 0},
    {{82813,78990,3202}, 0},
    {{18651,90094,47614}, 0},
    {{84271,55430,2264}, 0},
    {{92192,76742,54028}, 0},
    {{15998,19957,50618}, 0},
    {{86876,37987,62950}, 0},
    {{64480,58947,21261}, 0},
    {{89725,21657,87703}, 0},
    {{41835,26387,48999}, 0},
    {{90522,49124,65871}, 0},
    {{31670,99557,50809}, 0},
    {{36947,50855,45723}, 0},
    {{18749,87539,62358}, 0},
    {{46869,21125,32563}, 0},
    {{67622,57288,74567}, 0},
    {{73157,5144,32827}, 0},
    {{53195,11971,90266}, 0},
    {{98125,7165,44773}, 0},
    {{60723,69364,6778}, 0},
    {{80264,20533,50571}, 0},
    {{97937,32404,87327}, 0},
    {{36686,96669,99139}, 0},
    {{29955,88425,63681}, 0},
    {{21072,71322,98402}, 0},
    {{41045,37772,33585}, 0},
    {{14299,41821,89231}, 0},
    {{21639,82041,6922}, 0},
    {{57825,99703,92545}, 0},
    {{62186,1461,82959}, 0},
    {{71523,60212,81856}, 0},
    {{80533,18960,97007}, 0},
    {{60572,21702,48132}, 0},
    {{81438,88213,28382}, 0},
    {{72393,67254,94704}, 0},
    {{63491,59558,52412}, 0},
    {{47468,56643,601}, 0},
    {{10483,53497,51221}, 0},
    {{92823,54077,65579}, 0},
    {{15749,2864,83036}, 0},
    {{14106,48677,76161}, 0},
    {{41155,27150,80418}, 0},
    {{85319,77736,52604}, 0},
    {{36357,37413,75387}, 0},
    {{38522,86460,81429}, 0},
    {{87139,19234,33260}, 0},
    {{2045,5895,54921}, 0},
    {{12883,49661,31979}, 0},
    {{66977,31307,22576}, 0},
    {{82507,38443,78239}, 0},
    {{83185,4579,22123}, 0},
    {{47468,93052,75972}, 0},
    {{34416,8876,92296}, 0},
    {{47848,52742,82787}, 0},
    {{17107,57479,72524}, 0},
    {{41163,49255,1871}, 0},
    {{86438,27165,66231}, 0},
    {{59255,96018,39815}, 0},
    {{17374,2167,52233}, 0},
    {{64139,86094,97794}, 0},
    {{97477,50013,21444}, 0},
    {{6364,73142,10821}, 0},
    {{83010,91800,92783}, 0},
    {{52376,54944,59349}, 0},
    {{15771,74734,50157}, 0},
    {{48014,96320,56648}, 0},
    {{61024,80857,11151}, 0},
    {{21537,73660,19876}, 0},
    {{69896,52549,68833}, 0},
    {{74023,97096,25402}, 0},
    {{92397,66269,5459}, 0},
    {{34353,14555,8617}, 0},
    {{96527,17308,72150}, 0},
    {{50663,67435,29516}, 0},
    {{27375,28443,38444}, 0},
    {{55584,94705,24498}, 0},
    {{64327,91112,14611}, 0},
    {{68844,48709,17730}, 0},
    {{55558,32975,41214}, 0},
    {{58806,37368,47286}, 0},
    {{86290,52900,10056}, 0},
    {{66220,84867,53765}, 0},
    {{28329,7680,77279}, 0},
    {{40360,7164,54302}, 0},
    {{11454,49187,66678}, 0},
    {{57392,3797,70847}, 0},
    {{2434,70699,63093}, 0},
    {{49989,91650,34832}, 0},
    {{37816,4930,47372}, 0},
    {{65539,74066,22742}, 0},
    {{5844,85041,70935}, 0},
    {{65329,11043,97306}, 0},
    {{80026,40080,92152}, 0},
    {{897,80326,88609}, 0},
    {{1610,69699,34305}, 0},
    {{42575,44106,8338}, 0},
    {{88353,95711,20420}, 0},
    {{8920,64255,75460}, 0},
    {{88359,35446,18772}, 0},
    {{40540,99321,35951}, 0},
    {{47543,27619,60230}, 0},
    {{7275,25951,61120}, 0},
    {{43104,98183,13384}, 0},
    {{85885,78432,50972}, 0},
    {{75218,88816,23228}, 0},
    {{25312,76966,18981}, 0},
    {{53524,79075,82222}, 0},
    {{67672,46513,65462}, 0},
    {{96641,22301,56110}, 0},
    {{42758,77109,98146}, 0},
    {{52963,39318,2919}, 0},
    {{87288,65436,11366}, 0},
    {{45348,47355,80636}, 0},
    {{22314,85923,7284}, 0},
    {{16812,39759,11195}, 0},
    {{61372,72256,28005}, 0},
    {{43689,95481,67127}, 0},
    {{30777,72080,74244}, 0},
    {{88226,19303,87504}, 0},
    {{70055,1779,86562}, 0},
    {{62613,33062,33771}, 0},
    {{18516,72491,56513}, 0},
    {{13407,69541,25411}, 0},
    {{48774,4088,21998}, 0},
    {{71728,67980,93146}, 0},
    {{61518,92657,38383}, 0},
    {{50405,88420,17669}, 0},
    {{37055,45753,75139}, 0},
    {{83965,22900,21539}, 0},
    {{97853,61105,33734}, 0},
    {{15445,9731,30921}, 0},
    {{40059,90110,93487}, 0},
    {{53279,85765,46846}, 0},
    {{57867,90598,56679}, 0},
    {{14701,83246,5622}, 0},
    {{5026,74327,23044}, 0},
    {{40661,69780,50646}, 0},
    {{52466,68664,7485}, 0},
    {{3198,74819,72603}, 0},
    {{77212,37666,52312}, 0},
    {{46268,77389,80995}, 0},
    {{65960,60853,83038}, 0},
    {{931,35054,34669}, 0},
    {{78349,98930,36778}, 0},
    {{12973,71294,73930}, 0},
    {{71386,78712,40983}, 0},
    {{99293,66910,98647}, 0},
    {{32888,2802,23396}, 0},
    {{70951,36583,11198}, 0},
    {{62258,96278,61806}, 0},
    {{58608,88263,93202}, 0},
    {{54159,49239,45330}, 0},
    {{27725,46219,66652}, 0},
    {{72409,14722,34260}, 0},
    {{87507,50958,74103}, 0},
    {{67708,59992,3578}, 0},
    {{16315,77120,64800}, 0},
    {{16156,78549,87552}, 0},
    {{78138,39194,5522}, 0},
    {{34987,86015,92824}, 0},
    {{45448,42838,61281}, 0},
    {{83354,24416,18869}, 0},
    {{59378,5108,39885}, 0},
    {{97165,35422,81944}, 0},
    {{28632,98499,49491}, 0},
    {{19344,75937,90797}, 0},
    {{44442,25615,33902}, 0},
    {{50960,32184,93916}, 0},
    {{57896,13308,61387}, 0},
    {{53734,84672,18194}, 0},
    {{8660,28733,4652}, 0},
    {{78185,3157,18943}, 0},
    {{98317,66564,73722}, 0},
    {{39622,44173,13257}, 0},
    {{80304,41566,77998}, 0},
    {{2613,35622,41642}, 0},
    {{12424,93436,36799}, 0},
    {{55874,67410,88379}, 0},
    {{53576,37098,28996}, 0},
    {{33013,73365,26094}, 0},
    {{41442,16895,93060}, 0},
    {{69026,50404,23541}, 0},
    {{2409,89035,88211}, 0},
    {{53876,98704,18933}, 0},
    {{21174,50362,52574}, 0},
    {{62384,39994,25209}, 0},
    {{49930,98823,52757}, 0},
    {{45905,26601,42889}, 0},
    {{53216,31422,95451}, 0},
    {{11809,60789,41100}, 0},
    {{17425,7129,21009}, 0},
    {{191,59331,33074}, 0},
    {{82286,57626,4379}, 0},
    {{18996,25744,45777}, 0},
    {{73469,93524,76170}, 0},
    {{43165,83829,42679}, 0},
    {{3489,90380,19287}, 0},
    {{32130,82827,89429}, 0},
    {{36788,57685,97554}, 0},
    {{16496,54760,19802}, 0},
    {{81414,88462,99738}, 0},
    {{73314,24047,61708}, 0},
    {{62101,47588,37247}, 0},
    {{76559,84377,44008}, 0},
    {{58802,37729,76039}, 0},
    {{15010,75811,87123}, 0},
    {{86933,94115,82123}, 0},
    {{54009,43027,50596}, 0},
    {{54859,83864,38417}, 0},
    {{70884,85400,52967}, 0},
    {{17627,45951,31465}, 0},
    {{73990,73400,57850}, 0},
    {{52021,18604,23930}, 0},
    {{87155,37099,7360}, 0},
    {{36814,97317,73876}, 0},
    {{3217,97060,22855}, 0},
    {{80471,52071,5789}, 0},
    {{90240,54347,27961}, 0},
    {{72653,17088,95274}, 0},
    {{99522,76702,64574}, 0},
    {{78799,52143,10644}, 0},
    {{96717,37956,92741}, 0},
    {{56362,29034,4448}, 0},
    {{73447,23800,18279}, 0},
    {{19230,90590,642}, 0},
    {{58228,32856,16682}, 0},
    {{31128,47114,22318}, 0},
    {{77459,63932,87232}, 0},
    {{80393,92179,71614}, 0},
    {{62857,20743,3132}, 0},
    {{58382,28939,54649}, 0},
    {{56645,94728,79653}, 0},
    {{58994,90751,73198}, 0},
    {{65900,78107,89014}, 0},
    {{90685,96942,499}, 0},
    {{82143,71151,9875}, 0},
    {{74299,1835,35686}, 0},
    {{77183,79082,99241}, 0},
    {{61967,66923,46218}, 0},
    {{44660,5166,80608}, 0},
    {{12440,87949,50417}, 0},
    {{93660,31937,20171}, 0},
    {{51566,73911,49147}, 0},
    {{76489,70697,81120}, 0},
    {{18200,25957,52203}, 0},
    {{69689,24355,24167}, 0},
    {{48075,56746,29142}, 0},
    {{55367,7511,46569}, 0},
    {{93532,58396,73816}, 0},
    {{52087,84390,39320}, 0},
    {{10307,46088,98507}, 0},
    {{98000,40016,44082}, 0},
    {{38433,87651,12631}, 0},
    {{41767,95520,38953}, 0},
    {{57279,41175,71466}, 0},
    {{93367,88331,28212}, 0},
    {{41147,35131,70028}, 0},
    {{51993,865,96054}, 0},
    {{26764,83674,88651}, 0},
    {{41090,91802,43988}, 0},
    {{21936,61758,95795}, 0},
    {{18182,94724,96470}, 0},
    {{5987,72144,66828}, 0},
    {{25793,80778,31168}, 0},
    {{74537,22398,16245}, 0},
    {{33788,91256,62234}, 0},
    {{40226,67461,71641}, 0},
    {{69037,85276,84486}, 0},
    {{60114,89239,18636}, 0},
    {{78594,28511,483}, 0},
    {{70567,32202,5127}, 0},
    {{92907,22244,67532}, 0},
    {{53367,28230,51419}, 0},
    {{12074,70336,54016}, 0},
    {{94426,19283,79413}, 0},
    {{7719,42852,32624}, 0},
    {{44550,91786,24090}, 0},
    {{97273,3739,93760}, 0},
    {{8831,75645,3776}, 0},
    {{96717,82553,15939}, 0},
    {{74863,10174,19805}, 0},
    {{26696,51237,10575}, 0},
    {{12286,83670,70284}, 0},
    {{26504,47694,10852}, 0},
    {{47738,25780,84304}, 0},
    {{47083,68345,50461}, 0},
    {{55218,9260,70932}, 0},
    {{18736,145,57506}, 0},
    {{72396,38545,15870}, 0},
    {{36036,28495,2010}, 0},
    {{38976,23655,89418}, 0},
    {{99289,95832,62180}, 0},
    {{77239,78871,40829}, 0},
    {{10664,172,13678}, 0},
    {{39821,83437,67887}, 0},
    {{10299,72788,94927}, 0},
    {{83400,25480,29054}, 0},
    {{42411,43523,59394}, 0},
    {{46661,86695,72759}, 0},
    {{60626,21494,31729}, 0},
    {{68666,61021,43766}, 0},
    {{87881,31838,19206}, 0},
    {{41987,24719,55464}, 0},
    {{75537,55383,61279}, 0},
    {{30045,46251,63105}, 0},
    {{2764,83664,24651}, 0},
    {{65808,49167,90101}, 0},
    {{28234,6223,74430}, 0},
    {{81855,74700,89081}, 0},
    {{94227,56483,81006}, 0},
    {{96802,10429,48855}, 0},
    {{28096,20137,83805}, 0},
    {{3425,91918,27848}, 0},
    {{50614,46203,7156}, 0},
    {{76465,59663,60926}, 0},
    {{53923,21136,74495}, 0},
    {{85388,66276,87336}, 0},
    {{9765,87723,82726}, 0},
    {{27125,65073,66716}, 0},
    {{48124,34212,86025}, 0},
    {{61266,39362,71303}, 0},
    {{37360,689,7460}, 0},
    {{58180,72545,86518}, 0},
    {{90051,37290,47549}, 0},
    {{57274,62249,28082}, 0},
    {{62532,47721,22828}, 0},
    {{75117,46554,43674}, 0},
    {{95864,6455,88933}, 0},
    {{40290,6083,36924}, 0},
    {{92521,6928,26464}, 0},
    {{59497,93747,23590}, 0},
    {{18093,71649,90930}, 0},
    {{94193,80055,31973}, 0},
    {{14041,29596,98503}, 0},
    {{55364,87998,80534}, 0},
    {{52284,48295,8888}, 0},
    {{47311,72900,94508}, 0},
    {{3406,91750,20636}, 0},
    {{6997,50787,78274}, 0},
    {{79767,15581,51682}, 0},
    {{8091,73539,7367}, 0},
    {{57512,24650,85517}, 0},
    {{46699,68150,33589}, 0},
    {{55767,84255,45963}, 0},
    {{28070,7738,4006}, 0},
    {{24909,55346,90549}, 0},
    {{29859,48240,24838}, 0},
    {{79393,19012,95121}, 0},
    {{97229,28011,49772}, 0},
    {{42006,21000,77443}, 0},
    {{81733,99744,93278}, 0},
    {{86772,34673,12126}, 0},
    {{19502,8203,28912}, 0},
    {{49824,67526,1034}, 0},
    {{28700,78641,50796}, 0},
    {{88714,76573,79637}, 0},
    {{9000,58932,40939}, 0},
    {{97347,68200,88525}, 0},
    {{81868,51195,73324}, 0},
    {{19668,77366,63521}, 0},
    {{69747,99475,20393}, 0},
    {{99004,25685,26652}, 0},
    {{67189,26833,99404}, 0},
    {{82438,82069,75500}, 0},
    {{63793,91857,19743}, 0},
    {{56003,62275,99455}, 0},
    {{21208,52161,24086}, 0},
    {{12587,75911,75477}, 0},
    {{60748,77278,44501}, 0},
    {{29130,79526,96000}, 0},
    {{11519,33212,21564}, 0},
    {{64069,84475,6960}, 0},
    {{83223,9102,9204}, 0},
    {{48583,37369,34848}, 0},
    {{85319,78194,98461}, 0},
    {{42201,40008,32526}, 0},
    {{90572,73261,23034}, 0},
    {{3555,82822,72487}, 0},
    {{86232,68174,62182}, 0},
    {{7327,92475,47795}, 0},
    {{61731,40954,93078}, 0},
    {{89619,53775,5051}, 0},
    {{20159,63661,35080}, 0},
    {{10732,58177,98809}, 0},
    {{66904,42146,3558}, 0},
    {{28876,9491,57770}, 0},
    {{55301,16215,90925}, 0},
    {{38560,35173,60721}, 0},
    {{38335,55880,41396}, 0},
    {{69552,47655,23115}, 0},
    {{42786,55539,81821}, 0},
    {{57261,14542,86677}, 0},
    {{29204,26290,66068}, 0},
    {{26339,70222,36976}, 0},
    {{74487,73724,43976}, 0},
    {{20030,94128,40714}, 0},
    {{64785,65197,87178}, 0},
    {{27590,55060,20400}, 0},
    {{8599,93405,62889}, 0},
    {{94617,69964,53095}, 0},
    {{55078,44070,12480}, 0},
    {{83077,86697,2062}, 0},
    {{95161,29458,72081}, 0},
    {{62766,76286,1287}, 0},
    {{27855,3131,56247}, 0},
    {{98134,42162,31215}, 0},
    {{99861,83101,94708}, 0},
    {{66605,53108,24683}, 0},
    {{16216,73581,70808}, 0},
    {{13462,23078,91388}, 0},
    {{30671,20981,90629}, 0},
    {{963,98599,31141}, 0},
    {{66767,72922,48643}, 0},
    {{931,64677,98264}, 0},
    {{17199,23020,79835}, 0},
    {{78277,69206,82762}, 0},
    {{31012,62614,78427}, 0},
    {{55429,39042,69569}, 0},
    {{24191,44063,99865}, 0},
    {{97432,3336,46388}, 0},
    {{31959,63839,63616}, 0},
    {{81908,42463,66393}, 0},
    {{19463,42889,53884}, 0},
    {{94233,93408,29740}, 0},
    {{14620,89726,88160}, 0},
    {{30691,15039,42095}, 0},
    {{81724,35094,87610}, 0},
    {{58404,42467,50476}, 0},
    {{7867,70143,82222}, 0},
    {{68077,25131,28148}, 0},
    {{26578,71526,7458}, 0},
    {{52628,29441,67261}, 0},
    {{11095,8743,54012}, 0},
    {{55445,48996,42922}, 0},
    {{48231,15996,91774}, 0},
    {{75679,4569,54824}, 0},
    {{73736,91340,1719}, 0},
    {{89430,98540,60118}, 0},
    {{45217,3842,46850}, 0},
    {{21971,37216,32460}, 0},
    {{56149,31866,61082}, 0},
    {{81100,16951,97183}, 0},
    {{64431,21995,70087}, 0},
    {{47722,41080,13734}, 0},
    {{96084,42720,26622}, 0},
    {{73323,23020,95575}, 0},
    {{38583,37329,96290}, 0},
    {{51860,66773,84275}, 0},
    {{18881,88538,85410}, 0},
    {{88462,89453,68895}, 0},
    {{50367,43426,7754}, 0},
    {{27935,23484,34430}, 0},
    {{40834,24518,43858}, 0},
    {{76728,22465,59186}, 0},
    {{32646,38248,3491}, 0},
    {{58698,63768,70710}, 0},
    {{16068,50742,20267}, 0},
    {{5082,89786,34196}, 0},
    {{29823,49831,68853}, 0},
    {{66882,76621,29660}, 0},
    {{255,70699,25732}, 0},
    {{40256,60498,12575}, 0},
    {{1878,45444,24183}, 0},
    {{50575,59238,82269}, 0},
    {{70539,30634,37234}, 0},
    {{35479,72652,15913}, 0},
    {{49775,13080,71167}, 0},
    {{60364,33479,2091}, 0},
    {{49755,92421,81164}, 0},
    {{61373,65485,84204}, 0},
    {{92251,76079,76207}, 0},
    {{41051,46092,41782}, 0},
    {{76761,39081,20090}, 0},
    {{3337,54645,62752}, 0},
    {{36924,58219,96896}, 0},
    {{86726,97233,62042}, 0},
    {{87387,7695,81557}, 0},
    {{87662,86418,52145}, 0},
    {{41810,82451,61873}, 0},
    {{69267,34470,11337}, 0},
    {{67991,7463,19226}, 0},
    {{38236,39000,75317}, 0},
    {{85168,83818,70798}, 0},
    {{99619,6496,53450}, 0},
    {{15220,24334,38894}, 0},
    {{82221,64080,94642}, 0},
    {{71679,22418,80530}, 0},
    {{52665,57771,57414}, 0},
    {{64718,38716,69754}, 0},
    {{71179,61390,60358}, 0},
    {{24502,17126,15936}, 0},
    {{16804,87971,98613}, 0},
    {{20108,67842,5243}, 0},
    {{6851,12051,23271}, 0},
    {{96082,22945,80393}, 0},
    {{23430,43510,18599}, 0},
    {{87644,45803,69870}, 0},
    {{25063,62543,32491}, 0},
    {{12726,49828,98597}, 0},
    {{3812,59971,23955}, 0},
    {{41102,33143,91460}, 0},
    {{55331,97174,75617}, 0},
    {{72246,41479,82895}, 0},
    {{467,2488,83337}, 0},
    {{43633,94881,10820}, 0},
    {{13850,83940,21465}, 0},
    {{74415,63797,2826}, 0},
    {{96079,10381,85403}, 0},
    {{26,46389,42982}, 0},
    {{21579,45821,41231}, 0},
    {{50470,76566,57660}, 0},
    {{88565,8028,20208}, 0},
    {{13789,65701,1194}, 0},
    {{52413,39575,14459}, 0},
    {{1688,2842,4220}, 0},
    {{39545,97199,30824}, 0},
    {{62146,38482,3550}, 0},
    {{86310,8016,52708}, 0},
    {{74706,59941,842}, 0},
    {{12942,59307,81345}, 0},
    {{63486,74217,82507}, 0},
    {{20864,57533,65591}, 0},
    {{38436,17094,99492}, 0},
    {{66991,54702,27906}, 0},
    {{45062,30019,35591}, 0},
    {{71981,3060,58367}, 0},
    {{23216,93621,66989}, 0},
    {{50818,2227,31623}, 0},
    {{87003,23066,69170}, 0},
    {{40563,25541,26665}, 0},
    {{67000,56666,55604}, 0},
    {{89398,56986,56552}, 0},
    {{23872,1222,31969}, 0},
    {{28827,46115,71239}, 0},
    {{36155,5112,90743}, 0},
    {{86815,6091,26132}, 0},
    {{50321,38914,57932}, 0},
    {{30035,89738,6669}, 0},
    {{29416,82243,84136}, 0},
    {{57768,16871,39561}, 0},
    {{36914,53480,93218}, 0},
    {{84683,67078,2598}, 0},
    {{31130,42003,21215}, 0},
    {{86810,4428,11026}, 0},
    {{45451,51107,82578}, 0},
    {{31754,20488,82096}, 0},
    {{38882,36981,43136}, 0},
    {{70263,48024,92262}, 0},
    {{32616,47,77272}, 0},
    {{75783,52136,35616}, 0},
    {{66230,90864,96061}, 0},
    {{66776,20044,24418}, 0},
    {{81351,65602,1911}, 0},
    {{89303,57022,42225}, 0},
    {{33138,98948,66556}, 0},
    {{10344,87517,83293}, 0},
    {{51448,7253,85107}, 0},
    {{38572,7114,7599}, 0},
    {{46386,14680,9309}, 0},
    {{18259,97981,46026}, 0},
    {{35717,7310,26690}, 0},
    {{70546,55811,62233}, 0},
    {{49180,10574,46285}, 0},
    {{70554,4648,95031}, 0},
    {{79648,94893,29864}, 0},
    {{29037,2106,68762}, 0},
    {{47564,91682,61919}, 0},
    {{59863,86266,213}, 0},
    {{21410,44682,62545}, 0},
    {{86846,11011,67801}, 0},
    {{44914,18488,90828}, 0},
    {{47850,95088,57894}, 0},
    {{28513,61009,50034}, 0},
    {{33600,88452,24226}, 0},
    {{83269,4009,39161}, 0},
    {{1212,22056,75195}, 0},
    {{7778,22167,17874}, 0},
    {{79786,63238,61338}, 0},
    {{75046,6563,43245}, 0},
    {{98684,23301,55640}, 0},
    {{38293,8608,34625}, 0},
    {{91063,49078,36208}, 0},
    {{20894,73292,49303}, 0},
    {{96559,58636,20352}, 0},
    {{87519,23549,85513}, 0},
    {{50127,30756,23284}, 0},
    {{1104,39951,4869}, 0},
    {{3044,62917,33105}, 0},
    {{85974,35110,14522}, 0},
    {{17695,92472,95715}, 0},
    {{19038,75952,68748}, 0},
    {{45970,49331,89719}, 0},
    {{72764,73693,52530}, 0},
    {{18016,21657,24015}, 0},
    {{27987,76912,85975}, 0},
    {{20324,46638,30729}, 0},
    {{86159,25024,78450}, 0},
    {{91703,48733,47751}, 0},
    {{61068,56277,46895}, 0},
    {{64724,35091,27828}, 0},
    {{74908,10619,12850}, 0},
    {{53723,1565,57685}, 0},
    {{34482,90720,2247}, 0},
    {{48825,60634,41928}, 0},
    {{91973,66035,53510}, 0},
    {{82060,36058,52337}, 0},
    {{60399,75824,9761}, 0},
    {{25223,64490,87193}, 0},
    {{43082,55997,60995}, 0},
    {{60069,9675,25668}, 0},
    {{82168,13746,889}, 0},
    {{92109,66067,89185}, 0},
    {{49712,2159,49643}, 0},
    {{70809,87132,22374}, 0},
    {{42176,46025,79610}, 0},
    {{39169,79785,13752}, 0},
    {{18825,34051,34367}, 0},
    {{82252,6749,90664}, 0},
    {{24367,42718,70613}, 0},
    {{59734,12443,69837}, 0},
    {{99291,28674,79553}, 0},
    {{59851,50139,94341}, 0},
    {{95566,89541,60142}, 0},
    {{4569,69698,16896}, 0},
    {{73351,59466,12724}, 0},
    {{57451,26762,75305}, 0},
    {{23361,53953,91096}, 0},
    {{24659,25600,84401}, 0},
    {{6701,47677,41957}, 0},
    {{49981,73558,66019}, 0},
    {{32211,51399,79308}, 0},
    {{47526,58794,2992}, 0},
    {{81276,54434,41783}, 0},
    {{78462,94606,38348}, 0},
    {{29645,11545,95388}, 0},
    {{12768,60327,47198}, 0},
    {{13631,37232,932}, 0},
    {{15921,48493,78354}, 0},
    {{40942,13563,1614}, 0},
    {{80585,10552,82842}, 0},
    {{65845,49345,40301}, 0},
    {{37277,72640,48612}, 0},
    {{76770,34551,72133}, 0},
    {{70247,8839,11346}, 0},
    {{92769,91963,43794}, 0},
    {{66893,13056,96789}, 0},
    {{78670,8721,50036}, 0},
    {{64492,52865,84998}, 0},
    {{73994,80260,30635}, 0},
    {{3000,46773,48714}, 0},
    {{7863,3564,16845}, 0},
    {{34743,34383,2190}, 0},
    {{34824,48127,39962}, 0},
    {{11166,86243,27957}, 0},
    {{20474,66853,92972}, 0},
    {{55137,22568,3532}, 0},
    {{74744,97234,47881}, 0},
    {{31202,43977,35493}, 0},
    {{60681,32125,70805}, 0},
    {{62367,77506,45789}, 0},
    {{58725,87234,21123}, 0},
    {{5756,79120,49}, 0},
    {{59165,65274,56916}, 0},
    {{63331,3097,56263}, 0},
    {{26716,71595,15213}, 0},
    {{45380,11457,75524}, 0},
    {{41835,6913,71059}, 0},
    {{776,98134,83249}, 0},
    {{37445,8259,34490}, 0},
    {{95308,29768,36740}, 0},
    {{67412,78669,4196}, 0},
    {{90273,13196,7376}, 0},
    {{74377,15408,99304}, 0},
    {{73183,69355,97589}, 0},
    {{78475,80184,16542}, 0},
    {{66566,41437,5551}, 0},
    {{29148,68594,25621}, 0},
    {{49051,84679,53482}, 0},
    {{85126,24907,37495}, 0},
    {{59293,9297,37545}, 0},
    {{61809,12015,17536}, 0},
    {{71389,58549,4787}, 0},
    {{82331,27739,31214}, 0},
    {{77013,33020,68096}, 0},
    {{82161,81626,13508}, 0},
    {{2488,55568,45206}, 0},
    {{28461,67942,49817}, 0},
    {{84983,36136,21513}, 0},
    {{97295,25849,80894}, 0},
    {{64329,9807,44371}, 0},
    {{4296,78708,73186}, 0},
    {{73054,7426,5473}, 0},
    {{44708,2200,36856}, 0},
    {{89390,24656,77054}, 0},
    {{37171,48832,91674}, 0},
    {{70523,10711,73050}, 0},
    {{76565,15553,82937}, 0},
    {{54300,6616,63102}, 0},
    {{24179,29751,52132}, 0},
    {{30878,86308,42617}, 0},
    {{7040,72237,89071}, 0},
    {{56404,9204,3828}, 0},
    {{22850,25685,12958}, 0},
    {{64083,40897,5870}, 0},
    {{80712,12661,89880}, 0},
    {{28812,27914,73054}, 0},
    {{78010,64424,93170}, 0},
    {{27625,48913,30906}, 0},
    {{36127,27193,45106}, 0},
    {{48005,50030,84428}, 0},
    {{65,90041,59062}, 0},
    {{8862,18079,23000}, 0},
    {{48615,5004,93097}, 0},
    {{66137,68227,72716}, 0},
    {{87591,77071,15009}, 0},
    {{22171,56292,41452}, 0},
    {{24045,89790,10918}, 0},
    {{35254,57957,74760}, 0},
    {{978,22560,41487}, 0},
    {{11221,56682,26207}, 0},
    {{4738,42547,23237}, 0},
    {{19715,36633,13609}, 0},
    {{68999,9734,99443}, 0},
    {{5691,6365,99159}, 0},
    {{72026,53780,84262}, 0},
    {{99162,15204,73617}, 0},
    {{1403,9689,25442}, 0},
    {{91610,23025,37300}, 0},
    {{80889,63369,87832}, 0},
    {{7680,60094,72242}, 0},
    {{61673,13638,77572}, 0},
    {{43450,58503,44412}, 0},
    {{45354,340,62116}, 0},
    {{89875,38006,43217}, 0},
    {{50335,46008,27007}, 0},
    {{96936,29763,52718}, 0},
    {{14263,57751,18256}, 0},
    {{29450,53645,62417}, 0},
    {{75044,90747,12361}, 0},
    {{481,37481,96215}, 0},
    {{13555,24321,17925}, 0},
    {{35614,79531,68844}, 0},
    {{84931,58893,87301}, 0},
    {{44468,67113,16875}, 0},
    {{69711,91869,94454}, 0},
    {{85484,75271,96361}, 0},
    {{26101,54530,5912}, 0},
    {{22797,2471,91172}, 0},
    {{16516,810,26693}, 0},
    {{53613,4331,24742}, 0},
    {{776,67920,75505}, 0},
    {{25448,67347,71175}, 0},
    {{24339,72871,91444}, 0},
    {{18603,36814,12108}, 0},
    {{38437,97567,60974}, 0},
    {{62671,95146,54194}, 0},
    {{14195,94917,49454}, 0},
    {{31135,2103,70660}, 0},
    {{98613,20118,50202}, 0},
    {{11557,34197,28279}, 0},
    {{31107,61214,39668}, 0},
    {{40973,55230,90288}, 0},
    {{99164,79291,67778}, 0},
    {{71202,18860,11631}, 0},
    {{10717,16166,97658}, 0},
    {{94438,5055,32717}, 0},
    {{95680,17091,40298}, 0},
    {{41253,57483,84510}, 0},
    {{17253,13432,74251}, 0},
    {{33502,34783,5740}, 0},
    {{63712,85338,86710}, 0},
    {{63985,8493,48410}, 0},
    {{2102,79526,99602}, 0},
    {{6786,20011,62272}, 0},
    {{60010,39536,1764}, 0},
    {{17116,78563,83261}, 0},
    {{2430,35640,23275}, 0},
    {{68327,14833,42627}, 0},
    {{57963,65046,69811}, 0},
    {{23719,92143,76985}, 0},
    {{95090,46249,11620}, 0},
    {{17515,60765,16997}, 0},
    {{79376,25884,44802}, 0},
    {{78660,51960,88840}, 0},
    {{48890,69215,16511}, 0},
    {{35142,65805,44682}, 0},
    {{35288,55328,68424}, 0},
    {{89119,32187,52805}, 0},
    {{62082,99840,30682}, 0},
    {{64083,59987,73816}, 0},
    {{70236,12705,73664}, 0},
    {{42886,43064,61805}, 0},
    {{60755,15294,16261}, 0},
    {{37080,92079,24305}, 0},
    {{52497,62169,25315}, 0},
    {{67546,7715,62461}, 0},
    {{87623,51908,32595}, 0},
    {{4805,67774,39667}, 0},
    {{697,7468,62032}, 0},
    {{52614,11774,36370}, 0},
    {{39837,26872,38519}, 0},
    {{86231,22849,5597}, 0},
    {{71105,66319,52501}, 0},
    {{7563,71673,84206}, 0},
    {{50223,53532,43260}, 0},
    {{63026,14682,70232}, 0},
    {{90432,80439,10923}, 0},
    {{13637,55663,74751}, 0},
    {{66472,63039,42717}, 0},
    {{95759,24079,78226}, 0},
    {{30181,56928,4745}, 0},
    {{91020,61938,69903}, 0},
    {{98496,15760,11569}, 0},
    {{62354,34465,21134}, 0},
    {{22178,22232,42331}, 0},
    {{57611,47365,4049}, 0},
    {{30362,93723,71394}, 0},
    {{30500,92504,83267}, 0},
    {{83043,31955,60472}, 0},
    {{80504,67243,70035}, 0},
    {{23456,97221,67969}, 0},
    {{74067,5604,73773}, 0},
    {{54671,91718,72635}, 0},
    {{24520,90072,80220}, 0},
    {{6926,39338,79600}, 0},
    {{81335,63617,38725}, 0},
    {{70138,72454,87636}, 0},
    {{16792,76022,50219}, 0},
    {{49748,24072,2437}, 0},
    {{22794,6776,12300}, 0},
    {{82241,4930,16876}, 0},
    {{86623,15547,64495}, 0},
    {{29715,10203,85760}, 0},
    {{89234,7227,31498}, 0},
    {{92355,66380,95013}, 0},
    {{38843,88601,11821}, 0},
    {{47683,601,36234}, 0},
    {{34239,70275,33928}, 0},
    {{20413,89296,69950}, 0},
    {{78728,2493,86948}, 0},
    {{77567,48082,5677}, 0},
    {{93135,7264,64786}, 0},
    {{74095,30004,9603}, 0},
    {{53435,53087,48713}, 0},
    {{27940,36862,55022}, 0},
    {{81083,52501,28288}, 0},
    {{87934,83721,48004}, 0},
    {{29788,84151,66695}, 0},
    {{761,52957,13225}, 0},
    {{51895,33945,98200}, 0},
    {{51551,70349,95462}, 0},
    {{39624,3350,77191}, 0},
    {{53642,8135,81199}, 0},
    {{14778,90289,86341}, 0},
    {{5310,73455,58587}, 0},
    {{85817,29403,3380}, 0},
    {{51579,76305,46815}, 0},
    {{95073,83768,53622}, 0},
    {{36556,29384,28421}, 0},
    {{40081,28018,65241}, 0},
    {{32909,20,61411}, 0},
    {{85141,86740,60684}, 0},
    {{4201,10192,76243}, 0},
    {{87302,29245,50457}, 0},
    {{137,25602,53668}, 0},
    {{62121,88461,1777}, 0},
    {{67298,13694,73695}, 0},
    {{17882,3257,71995}, 0},
    {{27136,71465,27170}, 0},
    {{73286,88269,27881}, 0},
    {{38049,81126,75993}, 0},
    {{15385,14081,79374}, 0},
    {{84347,65079,84085}, 0},
    {{13410,58295,71812}, 0},
    {{38304,67936,46470}, 0},
    {{928,27966,35163}, 0},
    {{60269,78746,29419}, 0},
    {{47428,94300,27246}, 0},
    {{105,84716,92796}, 0},
    {{45951,26882,68946}, 0},
    {{65664,37041,43532}, 0},
    {{63553,86825,36040}, 0},
    {{67585,81204,85742}, 0},
    {{71366,70770,5726}, 0},
    {{59402,59276,38107}, 0},
    {{24340,88107,20120}, 0},
    {{30703,92628,13223}, 0},
    {{26774,90410,42146}, 0},
    {{35000,68375,23807}, 0},
    {{88835,69500,78910}, 0},
    {{4031,79825,90186}, 0},
    {{83940,75980,98683}, 0},
    {{66950,66833,70326}, 0},
    {{33433,93574,44544}, 0},
    {{59586,47578,74473}, 0},
    {{82534,92848,8791}, 0},
    {{78978,18046,50017}, 0},
    {{50917,92805,14193}, 0},
    {{70117,27458,23062}, 0},
    {{36478,47232,64904}, 0},
    {{87280,45001,1040}, 0},
    {{25234,25660,85324}, 0},
    {{23427,23004,76376}, 0},
    {{58327,67739,24729}, 0},
    {{99521,63102,80380}, 0},
    {{49355,98879,59808}, 0},
    {{5755,27670,90969}, 0},
    {{96231,77848,67358}, 0},
    {{64921,62074,89511}, 0},
};

ulong part1(Poses& poses, int num_cables)
{
    auto n = poses.size();
    std::vector<std::tuple<ulong, Poses::iterator, Poses::iterator>> distances(n * (n - 1) / 2);
    auto dist = distances.begin();
    for (auto pos1=poses.begin(); pos1 != poses.end(); ++pos1)
    {
        for (auto pos2=pos1 + 1; pos2 != poses.end(); ++pos2, ++dist)
        {
            std::get<0>(*dist)
                = (pos1->first[0] - pos2->first[0]) * (pos1->first[0] - pos2->first[0])
                + (pos1->first[1] - pos2->first[1]) * (pos1->first[1] - pos2->first[1])
                + (pos1->first[2] - pos2->first[2]) * (pos1->first[2] - pos2->first[2]);
            std::get<1>(*dist) = pos1;
            std::get<2>(*dist) = pos2;
        }
    }

    std::sort(distances.begin(), distances.end(),
        [](const auto& p1, const auto& p2) -> bool
        {
            return std::get<0>(p1) < std::get<0>(p2);
        });

    int circuit{0};
    for (auto [dist, pos1, pos2]: distances)
    {
        if (num_cables == 0) break;
        if (pos1->second == 0)
        {
            if (pos2->second == 0)
            {
                ++circuit;
                pos1->second = circuit;
                pos2->second = circuit;
            }
            else
            {
                pos1->second = pos2->second;
            }
            --num_cables;
        }
        else if (pos2->second == 0)
        {
            pos2->second = pos1->second;
            --num_cables;
        }
        else if (pos1->second != pos2->second)
        {
            auto old_circuit = pos2->second;
            auto new_circuit = pos1->second;
            if (old_circuit < new_circuit)
                std::swap(old_circuit, new_circuit);
            for (auto& pos: poses)
            {
                if (pos.second == old_circuit)
                    pos.second = new_circuit;
            }
            --num_cables;
        }
        else
        {
            --num_cables;
        }

        if (num_cables < 0)
        {
            bool all_same{true};
            for (auto& pos: poses)
            {
                if (pos.second != 1)
                {
                    all_same = false;
                    break;
                }
            }
            if (all_same)
            {
                return pos1->first[0] * pos2->first[0];
            }
        }
    }

    std::vector<ulong> circuit_sizes(circuit, 0);
    for (auto& pos: poses)
    {
        if (pos.second != 0)
            ++circuit_sizes[pos.second];
    }

    std::sort(circuit_sizes.begin(), circuit_sizes.end(), std::greater<ulong>());

    return circuit_sizes[0] * circuit_sizes[1] * circuit_sizes[2];
}

int main()
{
    std::cout << part1(sample_poses, 10) << std::endl;
    std::cout << part1(test_poses, 1000) << std::endl;
    std::cout << part1(sample_poses, -1) << std::endl;
    std::cout << part1(test_poses, -1) << std::endl;
    return 0;
}
